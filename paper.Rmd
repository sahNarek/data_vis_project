---
title: "Cars Auctions"
author: "Erik Nuroyan, Narek Sahakyan"
output:
  pdf_document:
    toc: true
    toc_depth: 2
---

\newpage

# Introduction

The car auction market has become a significant part of the global automotive industry, with billions of dollars' worth of cars sold every year. In recent years, there has been a growing interest in using data visualization techniques to analyze and interpret large datasets related to the car auction market.

In this paper, we aim to test several hypotheses related to the car auction market using data visualization techniques.

To accomplish our goals, we will use a dataset that contains information on the prices, models, mileage, engine volume, damage type, and fuel type of cars sold in various car auctions around the world. We will use different data visualization techniques, including histograms, box plots, scatter plots, and bar charts, to compare and contrast data from different countries and analyze the relationships between variables.

We will first investigate whether damaged cars are more profitable to resell in Armenia than undamaged ones by comparing the prices of damaged and undamaged cars in the dataset. Next, we will examine the repair costs of Japanese and German cars in different countries to determine if there is a significant difference in repair expenses. Then, we will explore the impact of car color, mileage, and damage type on its price using regression models and scatter plots.

Finally, we will investigate whether most cars with less engine volume have petrol as a fuel type, by analyzing the distribution of engine volume and fuel type across different car models.

Overall, our study will demonstrate the importance of data visualization in analyzing the car auction market and provide valuable insights into the industry. By using a combination of data visualization techniques, we hope to gain a comprehensive understanding of the dataset and offer new insights into the car auction market.


# Datasets

This study uses two datasets that were scraped from car auction websites in the United States and Armenia. The US dataset includes information on 749 cars sold in various auctions across the country, while the Armenian dataset includes data on 1407 cars sold in different auctions in Armenia.

Both datasets contain information on the car's make and model, year of manufacture, mileage, engine volume, damage type, and fuel type, as well as the sale price at the auction. The data was cleaned and preprocessed to remove any inconsistencies or errors and to estimate the importing price of each car, which takes into account taxes, customs duties, and other expenses related to importing a car into a particular country.


# Hypotheses 

```{r, knitr::opts_chunk$set(echo = F,warning = FALSE, message = FALSE)}
knitr::opts_chunk$set(echo = TRUE, message=F, warning=F)
library(ggplot2)
library(gridExtra)
library(scales)
library(dplyr)

# Loading datasets
load(file='./data/am_cars.rda')
load(file='./data/us_cars.rda')
```

## Heavily damaged cars are more profitable to resell in Armenia.
```{r, echo=F}
combined_data <- left_join(us_cars, am_cars, by = join_by(x$Make == y$Make, 
                                                             x$Model.Group == y$Model,
                                                             x$Year == y$ProductionYear)) %>% na.omit()

summarised_data <- combined_data %>%
  group_by(Year, Make, Model.Group, Damage.Description) %>%
  summarise(Price.AM = as.integer(mean(Price.y)), Price.US_auction = as.integer(mean(Price.x)), 
            Price.Import = as.integer(mean(ImportPrice)), Price.shipping = 3000, 
            Price.Imported = as.integer(Price.US_auction * 1.20 + Price.Import + Price.shipping),
            US.Repair = as.integer(mean(Repair.cost)), Price.Retail = as.integer(mean(Est..Retail.Value)),
            Odometer.US = as.integer(mean(Odometer)), Odometer.AM = as.integer(mean(Mileage))
            ) %>% 
  filter(US.Repair != 0)


ggplot(summarised_data, aes(x = Price.Imported, y = Price.AM, color = factor(Damage.Description))) + 
  geom_point(aes(size = summarised_data$US.Repair),alpha = 0.3) + geom_abline(col = "red") + ggtitle("Imported car price vs local market price") + 
  xlab("Imported price(all expensed calculated) in USD") + ylab("Armenia market price of the car in USD") + 
  labs(color = "Damage type", size = "Repair cost in USD") 
```
As we can see most of the cars regardless of damage type are profitable to bring and resell in Armenia, but we have a few cars, where the damage is from front and their market price is lower than the price of the same car, when imported from US. We can see that in general if the repair cost is high, the profit can be higher, which leads to an idea that the repair cost in US is higher than in Armenia, as almost all of the cars imported to Armenia are damaged are repaired in Armenia for later usage or profitable sale. 


```{r, echo=F}

summarised_data$Repaired.US <- (summarised_data$Price.US_auction * 1.2) + summarised_data$US.Repair

ggplot(summarised_data, aes(x = Repaired.US, y = Price.Retail, color = factor(Damage.Description))) + 
  geom_point(aes(size = summarised_data$Odometer.US),alpha = 0.3) + geom_abline(col = "red") + ggtitle("Imported car price vs local market price") + 
  xlab("Cost of the car when repaired in US(USD)") + ylab("Retail cost of the car before the damage.(USD)") + 
  labs(color = "Damage type", size = "Mileage of the car") 
```
As we can see the the observations are equally distributed along the y = x line, meaning that depending on the type of the damage, the repair may be or may not profitable.
We can see that the repair is mostly profitable for cars with higher mileage, as most probably the parts can be bought from the OEM used market and the material cost will be cheap. We can see that most of the cars that are worth repairing in US are damaged from the Front side. As the material cost is going to be the same in Armenia and US, and actually in US the material cost may be even lower, as the market is more advanced there.

```{r, echo = F}
summarised_data$profit <- summarised_data$Price.AM - summarised_data$Price.Imported
summarised_data <- summarised_data %>%
  filter(profit > 0)
ggplot(summarised_data,aes(x = profit, y = Damage.Description)) + 
  geom_bar(stat = "identity", fill = "red") + ggtitle("Profit of reselling baed on damage type in USD") +
  xlab("Profit in USD") + ylab("Damage type") + scale_x_continuous(labels = comma)
```

As we can see the cars that are damaged from the front side are most profitable to resell in Armenia, whereas the cars with minor damages are not that profitable, as probably the repair cost is almost identical in United States. Also the cars that are hit from the front side, can have some technical problems with the engine, transmission or other technical components of the car, whereas the rear, side or minor damages are less likely to cause technical problems.



## Japanesse cars are cheaper to repair compared to German cars in Armenia.
```{r, echo=F}

german_car_names <- c("AUDI", "BMW", "MERCEDES-BENZ", "PORSCHE", "VOLKSWAGEN")

german_cars <- us_cars[us_cars$Make %in% german_car_names, ]
japanesse_cars <- us_cars[!(us_cars$Make %in% german_car_names), ]


ggplot(german_cars, aes(x = Repair.cost)) + 
  geom_density(fill = "lightblue") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Distribution of repair costs for German cars") +
  labs(x = "Repair cost", y = "Density")

ggplot(japanesse_cars, aes(x = Repair.cost)) + 
  geom_density(fill = "lightblue") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Distribution of repair costs for Japanesse cars") +
  labs(x = "Repair cost", y = "Density")

```

## Color, Mileage and damage type have a lot of impact on the cars price.

```{r, echo=F}

# Color

# For Armenia
ggplot(am_cars, aes(x = Color, y = Price)) + 
  geom_boxplot(fill = "lightblue") + 
  ylim(c(0, 120000)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Prices of the cars by color in Armenia") +
  labs(x = "Color", y = "Price")

# For the US
ggplot(us_cars, aes(x = Color, y = Est..Retail.Value)) + 
  geom_boxplot(fill = "lightblue") + 
  ylim(c(0, 120000)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Prices of the cars by color in US") +
  labs(x = "Color", y = "Price")


# Damage type and the Price
ggplot(us_cars, aes(x = Damage.Description, y = Price)) + 
  geom_violin(fill = "lightblue") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Prices of the cars by damage type in the US") +
  labs(x = "Damage type", y = "Price")


# Milage and the Price
# For US
ggplot(us_cars, aes(x = Odometer, y = Price)) + 
  geom_point(alpha = 0.3, color = "darkblue") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Prices of the cars by milage in the US") +
  labs(x = "Milage", y = "Price")

# For the Armenia
ggplot(am_cars, aes(x = Mileage, y = Price)) + 
  geom_point(alpha = 0.3, color = "darkblue") + 
  xlim(c(0, 200000)) + 
  ylim(c(0, 250000)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Prices of the cars by mileage in Armenia") +
  labs(x = "Milage", y = "Price")

```

## The popular cars in US and Armenia are quite different
```{r, echo=F}

# For US
ggplot(us_cars, aes(x = Make)) + 
  geom_bar(fill = "red") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Popular cars in US") +
  labs(x = "Car Model", y = "Count")

# For Armenia
ggplot(am_cars, aes(x = Make)) + 
  geom_bar(fill = "red") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Popular cars in Armenia") +
  labs(x = "Car Model", y = "Count")

```

# Conclusion


